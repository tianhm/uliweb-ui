riot.tag2("pagination",'<ul class="pagination"> <li if="{totalMessage}" class="disabled total"><a>{totalMessage}</a></li> <li if="{has_first}" class="first"><a href="#" onclick="{go(1)}"><raw content="{first}"></raw></a></li> <li if="{has_prev}" class="prev"><a href="#" onclick="{go(page-1)}"><raw content="{prev}"></raw></a></li> <li class="{page:true, active:p==page}" each="{p in pages}"><a href="#" onclick="{go(p)}">{p}</a></li> <li if="{has_next}" class="next"><a href="#" onclick="{go(page+1)}"><raw content="{next}"></raw></a></li> <li if="{has_last}" class="last"><a href="#" onclick="{go(totalPages)}"><raw content="{last}"></raw></a></li> <li if="{refresh}" class="refresh"><a href="#" onclick="{go(page)}"><raw content="{refresh}"></raw></a></li> </ul>',"","",function(a){var t=this;this.total=a.total,this.page=a.page||1,this.limit=a.limit||10,this.data=a.data,this.limits=a.limits||[10,20,30,40,50],this.size=a.size||10,this.pages=[],this.onpage=a.onPage||function(){return t.data.load(t.get_url(),function(a){return t.total=a.total,a.rows})},this.onpagechanged=a.onPageChanged,this._totalMessage=a.totalMessage||"共 $pages 页 / $records 条记录",this.prev=a.prev||"上一页",this.has_prev=!1,this.next=a.next||"下一页",this.has_next=!1,this.first=a.first||"首页",this.has_first=!1,this.last=a.last||"尾页",this.has_last=!1,this.refresh=a.refresh||"刷新",this.on("update",function(){this.url=a.url,this.total=a.total,t.show()}),this.get_url=function(a){return get_url(t.url,{page:a||t.page,limit:t.limit})},this.go=function(e){return f=function(s){t.page=e,a.onBeforePage&&"function"==typeof a.onBeforePage&&a.onBeforePage.call(t),t.onpage&&"function"==typeof t.onpage?$.when(t.onpage.call(t,e)).done(function(a){t.show(e),t.onpagechanged&&t.onpagechanged(e)}):t.show()},f},this.show=function(e){t.total=a.total||t.total,t.page=e||t.page,t.totalPages=parseInt(t.total/t.limit),t.total%t.limit>0&&t.totalPages++,t._totalMessage&&(t.totalMessage=t._totalMessage.replace("$pages",t.totalPages),t.totalMessage=t.totalMessage.replace("$records",t.total));var e=t.page,s=t.size/2;t.size%2>0&&(s=(t.size+1)/2);var i=1;e>=1&&e<=t.totalPages&&e>=s&&(i=t.totalPages-e>=s?e-(s-1):Math.max(t.totalPages-t.size+1,1)),t.pages=[];for(var o=i,l=Math.min(i+t.size-1,t.totalPages);o<=l;o++)t.pages.push(o);t.size>1?(t.has_prev=t.prev&&e>1,t.has_next=t.next&&e<t.totalPages,t.has_first=1!==i,t.has_last=t.pages[t.pages.length-1]<t.totalPages):(t.has_prev=!1,t.has_next=!1,t.has_last=!1,t.has_first=!1),t.update()}}),riot.tag2("raw","<span></span>","","",function(a){this.on("update",function(){this.root.innerHTML=a.content})});